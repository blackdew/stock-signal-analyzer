# 2025-10-15: 웹 대시보드 구현 회고

## 📅 날짜
2025년 10월 15일

## 🎯 목표
주식 신호 분석 결과를 텍스트 리포트가 아닌 **인터랙티브 웹 대시보드**로 시각화하여, 포트폴리오 현황과 매매 신호를 한눈에 파악할 수 있도록 개선

## ✨ 구현한 기능

### 1. JSON 리포트 생성기 (`src/report/json_generator.py`)
- **기능**: 분석 결과를 JSON 형식으로 직렬화
- **주요 과제**: pandas/numpy 타입을 Python 기본 타입으로 변환
- **해결 방법**:
  - 커스텀 `NumpyEncoder` 클래스 구현
  - `_convert_to_python_type()` 헬퍼 메서드로 타입 변환 통일
  - `int64`, `float64` 등 numpy 타입을 `int`, `float`로 자동 변환

### 2. 포트폴리오 요약 계산
- **기능**: CSV 파일의 수량 정보를 활용한 정확한 투자금액 계산
- **변경 사항**:
  - `PortfolioLoader.load_csv()` 반환값에 수량 딕셔너리 추가
  - 총 투자금액 = 매수가 × 수량 (각 종목별 합계)
  - 총 평가금액 = 현재가 × 수량 (각 종목별 합계)
- **결과**: 실제 포트폴리오 가치를 정확히 계산

### 3. 웹 대시보드 UI/UX

#### HTML 구조 (`web/dashboard.html`)
- 포트폴리오 요약 섹션
- 매수/매도 우선순위 리스트
- 종목별 상세 카드
- 필터링 버튼 (전체/매수/매도/관망)

#### CSS 디자인 (`web/static/css/style.css`)
- **디자인 철학**: 그라디언트 배경, 카드 기반 레이아웃
- **색상 스킴**:
  - 메인: 보라색 그라디언트 (#667eea ~ #764ba2)
  - 매수 신호: 초록색 (#27ae60)
  - 매도 신호: 빨간색 (#e74c3c)
  - 관망: 회색 (#95a5a6)
- **반응형 디자인**: 모바일/태블릿/PC 대응
- **인터랙션**: 호버 효과, 부드러운 전환 애니메이션

#### JavaScript 로직 (`web/static/js/app.js`)
- **Chart.js 통합**: 가격 차트 (종가 + MA20 + MA60)
- **데이터 로딩**: `fetch API`로 `latest.json` 로드
- **동적 렌더링**:
  - 포트폴리오 요약 카드
  - 우선순위 종목 리스트
  - 종목별 상세 카드 + 차트
- **필터링**: 매수/매도/관망 신호별 종목 필터링
- **포맷팅**: 가격, 퍼센트, 날짜 포맷 유틸리티

### 4. 웹서버 통합 (`main.py`)
- **`--web` 옵션 추가**:
  1. JSON 리포트 생성 및 저장
  2. Python HTTP 서버 실행 (포트 8002)
  3. 브라우저 자동 열기
  4. Ctrl+C로 서버 종료
- **멀티스레딩**: 서버를 별도 스레드에서 실행

## 🐛 해결한 이슈

### 1. numpy 타입 JSON 직렬화 오류
- **문제**: `TypeError: Object of type int64 is not JSON serializable`
- **원인**: pandas DataFrame에서 가져온 numpy 타입들이 JSON 직렬화 불가
- **해결**:
  ```python
  class NumpyEncoder(json.JSONEncoder):
      def default(self, obj):
          if isinstance(obj, (np.integer, np.int64, np.int32)):
              return int(obj)
          if isinstance(obj, (np.floating, np.float64, np.float32)):
              return float(obj)
          return super().default(obj)
  ```
- **교훈**: pandas/numpy와 JSON을 함께 사용할 때는 항상 타입 변환 필요

### 2. 수량 정보 누락
- **문제**: 초기 구현에서 1주씩만 계산하여 실제 투자금액과 차이 발생
- **해결**:
  - CSV 파일에서 수량 컬럼 읽기
  - 모든 계산에 수량 반영
  - `quantities` 딕셔너리를 전체 플로우에 추가
- **교훈**: 요구사항을 정확히 파악하고 실제 사용 사례를 고려해야 함

### 3. 포트 충돌
- **문제**: 8000, 8001 포트가 다른 프로젝트에서 사용 중
- **해결**: 8002 포트로 변경
- **개선점**: 환경 변수나 config로 포트 설정을 외부화하면 더 좋을 듯

## 📊 성과

### 정량적 성과
- **코드 라인**: 1,312줄 추가 (8개 파일)
  - JSON 생성기: 303줄
  - HTML: 82줄
  - CSS: 461줄
  - JavaScript: 365줄
- **구현 시간**: 약 2시간
- **기능**: 텍스트 리포트 → 풀스택 웹 대시보드

### 정성적 성과
- ✅ **사용성 대폭 개선**: 텍스트보다 차트가 훨씬 직관적
- ✅ **실시간 분석**: 브라우저에서 새로고침만으로 최신 데이터 확인
- ✅ **인터랙티브**: 필터링, 차트 호버 등 사용자 경험 향상
- ✅ **포트폴리오 관리**: 투자금, 수익률을 한눈에 파악

## 🎓 배운 점

### 1. 타입 시스템의 중요성
- pandas/numpy는 성능을 위해 자체 타입 사용
- 외부 시스템(JSON, 웹 등)과 통신 시 타입 변환 필수
- Python의 동적 타이핑이 편리하지만, 타입 불일치 문제는 여전히 발생

### 2. 프론트엔드 기술 스택 선택
- **선택한 스택**: Vanilla JavaScript + Chart.js
- **이유**:
  - 프레임워크 없이 빠르게 구현 가능
  - 의존성 최소화 (CDN만 사용)
  - 프로젝트 크기가 작아 복잡한 상태 관리 불필요
- **대안**: React/Vue를 사용하면 더 구조화된 코드 가능하지만 오버엔지니어링

### 3. 점진적 개선의 힘
- 처음부터 완벽한 설계를 하려 하지 않음
- 빠르게 프로토타입 구현 → 문제 발견 → 수정
- numpy 타입 오류도 실행 후 발견하여 즉시 수정

### 4. 사용자 피드백의 중요성
- "수량 파악이 제대로 안된거 같은데?"
- 즉각적인 피드백으로 실제 요구사항을 정확히 파악
- 기술적으로 완벽해도 사용자 니즈를 충족하지 못하면 의미 없음

## 🚀 개선 방향

### 단기 개선 (1주일 내)
1. **에러 처리 강화**
   - 데이터 로딩 실패 시 사용자 친화적 메시지
   - 네트워크 오류 핸들링

2. **차트 개선**
   - 캔들스틱 차트 추가
   - 거래량 차트 표시
   - 차트 확대/축소 기능

3. **포트폴리오 상세 정보**
   - 종목별 매수/매도 이력
   - 수익률 순위
   - 섹터별 분산 분석

### 중기 개선 (1개월 내)
1. **데이터 히스토리 관리**
   - 과거 리포트 보관 및 조회
   - 일별 수익률 추이 그래프

2. **알림 기능**
   - 매수/매도 신호 발생 시 이메일/웹훅 알림
   - 목표가 도달 알림

3. **백테스팅 기능**
   - 과거 신호 기반 수익률 시뮬레이션
   - 전략별 성과 비교

### 장기 개선 (3개월 내)
1. **데이터베이스 도입**
   - JSON → SQLite/PostgreSQL
   - 데이터 쿼리 및 분석 성능 향상

2. **사용자 인증**
   - 다중 사용자 지원
   - 개인별 포트폴리오 관리

3. **실시간 업데이트**
   - WebSocket으로 실시간 가격 업데이트
   - 자동 리포트 생성 및 푸시

## 💭 회고

### 잘한 점 ✅
1. **빠른 프로토타이핑**: 2시간 만에 작동하는 웹 대시보드 완성
2. **문제 해결 능력**: numpy 타입 오류를 신속하게 디버깅하고 해결
3. **사용자 중심 개발**: 피드백을 즉시 반영 (수량 정보 추가)
4. **코드 품질**: 모듈화된 구조, 명확한 함수명, 주석

### 아쉬운 점 ❌
1. **테스트 부재**: 유닛 테스트 없이 수동 테스트만 진행
2. **에러 처리 부족**: 예외 상황에 대한 대비 미흡
3. **성능 최적화**: 대량 데이터 처리 시 성능 미검증
4. **접근성**: 스크린 리더 등 접근성 고려 부족

### 다음에 시도할 것 🔄
1. **pytest로 테스트 코드 작성**: JSON 생성, 포트폴리오 계산 등
2. **TypeScript 도입 검토**: JavaScript 타입 안정성 확보
3. **성능 프로파일링**: 병목 구간 파악 및 최적화
4. **CI/CD 파이프라인**: 자동 테스트 및 배포

## 📈 다음 목표

### 즉시 (오늘~내일)
- [x] 웹 대시보드 구현 완료
- [x] 수량 기반 계산 적용
- [x] Git 커밋 및 문서화
- [ ] README 업데이트 (웹 대시보드 사용법 추가)

### 이번 주
- [ ] 에러 처리 강화
- [ ] 차트 개선 (캔들스틱, 거래량)
- [ ] 포트폴리오 상세 통계 추가

### 이번 달
- [ ] 데이터 히스토리 관리
- [ ] 알림 기능 구현
- [ ] 백테스팅 기능 추가

## 🙏 감사 인사

- **사용자 피드백**: 수량 정보 누락을 빠르게 발견할 수 있었음
- **Chart.js**: 간단하면서도 강력한 차트 라이브러리
- **Python 생태계**: pandas, numpy 등 풍부한 데이터 분석 도구
- **Claude Code**: 빠른 개발과 디버깅 지원

---

## 📝 기술 스택 정리

### Backend
- Python 3.12
- pandas, numpy (데이터 처리)
- FinanceDataReader (주가 데이터)
- http.server (내장 웹서버)

### Frontend
- HTML5
- CSS3 (Flexbox, Grid)
- Vanilla JavaScript (ES6+)
- Chart.js 4.4.0 (CDN)

### Infrastructure
- Git (버전 관리)
- uv (Python 패키지 매니저)
- macOS (개발 환경)

---

**작성자**: Claude Code
**작성일**: 2025년 10월 15일
**버전**: 1.0
