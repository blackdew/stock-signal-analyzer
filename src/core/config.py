"""
Core Configuration Module

섹터 순환 투자 전략을 위한 핵심 설정 파일.
분석 대상 섹터, 루브릭 가중치, 투자 등급 기준 등을 정의합니다.
"""

import os
from typing import Dict, List, Tuple

# =============================================================================
# 분석 대상 섹터 및 대표 종목
# =============================================================================

SECTORS: Dict[str, List[str]] = {
    "반도체": [
        "005930",  # 삼성전자
        "000660",  # SK하이닉스
        "042700",  # 한미반도체
        "403870",  # HPSP
        "058470",  # 리노공업
    ],
    "조선": [
        "010140",  # 삼성중공업
        "009540",  # 한국조선해양
        "042660",  # 한화오션
        "003620",  # 쌍용C&E
        "010620",  # 현대미포조선
    ],
    "방산": [
        "012450",  # 한화에어로스페이스
        "047810",  # 한국항공우주
        "064350",  # 현대로템
        "079550",  # LIG넥스원
        "273640",  # 한화시스템
    ],
    "원전": [
        "034020",  # 두산에너빌리티
        "009830",  # 한화솔루션 (원전사업)
        "071970",  # STX중공업
        "267260",  # HD현대일렉트릭
        "004490",  # 세방전지
    ],
    "전력기기": [
        "267260",  # HD현대일렉트릭
        "032560",  # 황금에스티
        "298040",  # 효성중공업
        "042670",  # HD현대인프라코어
        "009450",  # 경동나비엔
    ],
    "바이오": [
        "207940",  # 삼성바이오로직스
        "068270",  # 셀트리온
        "326030",  # SK바이오팜
        "141080",  # 레고켐바이오
        "145020",  # 휴젤
    ],
    "로봇": [
        "336260",  # 두산로보틱스
        "108490",  # 로보티즈
        "090710",  # 휴림로봇
        "309930",  # 오토닉스
        "950140",  # 잉글우드랩
    ],
    "자동차": [
        "005380",  # 현대자동차
        "000270",  # 기아
        "012330",  # 현대모비스
        "204320",  # 만도
        "161390",  # 한국타이어앤테크놀로지
    ],
    "신재생에너지": [
        "009830",  # 한화솔루션
        "112610",  # 씨에스윈드
        "117580",  # 대성에너지
        "093370",  # 후성
        "281740",  # 레인보우로보틱스
    ],
    "지주": [
        "000810",  # 삼성화재해상보험
        "003550",  # LG
        "001040",  # CJ
        "005490",  # POSCO홀딩스
        "006400",  # 삼성SDI
    ],
    "뷰티": [
        "090430",  # 아모레퍼시픽
        "285130",  # SK케미칼
        "263750",  # 펄어비스
        "078930",  # GS
        "051900",  # LG생활건강
    ],
}

# =============================================================================
# 루브릭 가중치 (기본값)
# =============================================================================

RUBRIC_WEIGHTS: Dict[str, int] = {
    "technical": 25,          # 기술적 분석 가중치 (추세, RSI, 지지/저항, MACD, ADX)
    "supply": 20,             # 수급 분석 가중치 (외국인, 기관, 거래대금)
    "fundamental": 20,        # 펀더멘털 분석 가중치 (PER, PBR, ROE, 성장률, 부채비율)
    "market": 15,             # 시장 환경 분석 가중치 (뉴스, 섹터모멘텀, 애널리스트)
    "risk": 10,               # 리스크 평가 가중치 (변동성, 베타, 하방리스크)
    "relative_strength": 10,  # 상대 강도 가중치 (섹터내순위, 시장대비알파)
}

# 하위 호환성을 위한 기존 가중치 (V1)
RUBRIC_WEIGHTS_V1: Dict[str, int] = {
    "technical": 30,
    "supply": 25,
    "fundamental": 25,
    "market": 20,
}

# =============================================================================
# 투자 등급 기준
# =============================================================================

INVESTMENT_GRADES: Dict[str, Tuple[int, int]] = {
    "Strong Buy": (80, 100),   # 강력 매수
    "Buy": (60, 79),           # 매수
    "Hold": (40, 59),          # 보유/관망
    "Sell": (20, 39),          # 매도
    "Strong Sell": (0, 19),    # 강력 매도
}

# =============================================================================
# 캐시 설정
# =============================================================================

CACHE_EXPIRE_HOURS: int = 24
CACHE_DIR: str = "output/data/cache"

# =============================================================================
# API 설정
# =============================================================================

# 환경변수에서 API 키 로드
NEWS_API_KEY: str = os.environ.get("NEWS_API_KEY", "")
OPENAI_API_KEY: str = os.environ.get("OPENAI_API_KEY", "")

# =============================================================================
# 유틸리티 함수
# =============================================================================

def get_grade_from_score(score: int) -> str:
    """
    점수를 기반으로 투자 등급을 반환합니다.

    Args:
        score: 0-100 사이의 점수

    Returns:
        투자 등급 문자열 (Strong Buy, Buy, Hold, Sell, Strong Sell)
    """
    for grade, (min_score, max_score) in INVESTMENT_GRADES.items():
        if min_score <= score <= max_score:
            return grade
    return "Hold"  # 기본값


def get_all_sector_symbols() -> List[str]:
    """
    모든 섹터의 종목 코드를 반환합니다.

    Returns:
        전체 종목 코드 리스트 (중복 제거)
    """
    all_symbols = []
    for symbols in SECTORS.values():
        all_symbols.extend(symbols)
    return list(set(all_symbols))


def get_sector_by_symbol(symbol: str) -> str:
    """
    종목 코드로 해당 섹터를 찾습니다.

    Args:
        symbol: 종목 코드

    Returns:
        섹터명 (찾지 못하면 "Unknown")
    """
    for sector, symbols in SECTORS.items():
        if symbol in symbols:
            return sector
    return "Unknown"
